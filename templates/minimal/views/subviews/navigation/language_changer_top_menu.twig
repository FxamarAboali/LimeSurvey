{#
    LimeSurvey
    Copyright (C) 2007-2017 The LimeSurvey Project Team / Louis Gac
    All rights reserved.
    License: GNU/GPL License v2 or later, see LICENSE.php
    LimeSurvey is free software. This version may have been modified pursuant
    to the GNU General Public License, and as distributed it includes or
    is derivative of works licensed under the GNU General Public License or
    other free or open source software licenses.
    See COPYRIGHT.php for copyright notices and details.

    (¯`·._.·(¯`·._.·  Language Changer for Top Menu ·._.·´¯)·._.·´¯)

    Show a language changer inside the top menu

    It's a typical bootstrap dropdown button.
    @see: http://getbootstrap.com/components/#dropdowns

    @var array  aSurveyInfo.alanguageChangerDatas.aListLang :  contains the list of available languages for this survey, 'language_code' => 'language name'
    @var string aSurveyInfo.alanguageChangerDatas.sSelected :  the language code of the selected language

    The language change is done via javascript
#}

{# There is many condition where the language changer should not be shown. Eg: there is only one language available #}
{% if  aSurveyInfo.alanguageChanger.show == true %}

    {#  we set a shortcut for aSurveyInfo.alanguageChangerDatas #}
    {% set aLCD  = aSurveyInfo.alanguageChanger.datas %}

    <!-- Language Changer, top menu version -->
    <li class="dropdown ls-no-js-hidden">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">

            {# NOTE:  {{ aLCD.aListLang[aLCD.sSelected] | t }}: retreives the language name of the selected language and translates it #}
            {{ "Language:" | t }} {{ aLCD.aListLang[aLCD.sSelected] | t }}
            <span class="caret"></span>
        </a>

        <ul class="dropdown-menu" id="langs-container" style="overflow: scroll">
            {# List of available languages.  #}
            {% for value, lang in aLCD.aListLang %}
                <li class="index-item">
                    <a href='#' data-limesurvey-lang='{{ value }}' class="ls-language-link">
                        {{ lang | t }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    </li>

    {#
        Generates a simple bootstrap HTML button using the Yii widget.
        @see: http://www.yiiframework.com/wiki/48/by-example-chtml/#hh2
        You can add remove attribute to the button via the array aButtonhtmlOptions
    #}
    {% set aButtonhtmlOptions = {
            'id'   : 'changlangButton',
            'type' : 'submit',
            'value': 'changelang',
            'name' : 'move',
            'class': 'btn btn-default ls-js-hidden',
            }
    %}

    {{
        C.Html.htmlButton(
        ("Change the language" | gT ),
        aButtonhtmlOptions
        )
    }}

{% endif %}

{# TODO: add a javascript file, and register it here #}
<script>
// Method for link
$(document).on('ready pjax:complete',function(){
    $('#langs-container').height($('#main-row').height());
    $('.ls-language-link').on('click', function(){
        var lang = $(this).data('limesurvey-lang');

        /* we are not in a forum, can not submit directly */
        if($('form#limesurvey').length==1){
            /* The limesurvey form exist in document, move select and button inside and click */
            $("form#limesurvey [name='lang']").remove();                        // Remove existing lang selector
            $("<input type='hidden'>").attr('name','lang').val(lang).appendTo($('form#limesurvey'));
            $('#changlangButton').clone().appendTo($('form#limesurvey')).click();
        }else{
            // If there are no form : we can't use it */
            /* No form, not targeturl : just see what happen */
            $("<form>", {
                "class":'ls-js-hidden',
                "html": '<input type="hidden" name="lang" value="' + lang + '" />',
                "method": 'get'
            }).appendTo(document.body).submit();
        }
    });
});
</script>
